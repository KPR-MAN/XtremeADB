name: Build XtremeADB macOS
on:
  workflow_dispatch:
jobs:
  build-macos:
    runs-on: macos-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install nuitka pillow zstandard imageio

      - name: Install UPX
        run: brew install upx

      - name: Build with Nuitka
        run: |
          python -m nuitka --standalone \
          --macos-app-icon=xadb.png \
          --company-name="KPR-MAN" \
          --product-name="Xtreme ADB" \
          --file-version=1.3.0.0 \
          --product-version=1.3.0.0 \
          --file-description="Xtreme ADB" \
          --remove-output \
          --python-flag=no_docstrings \
          --python-flag=no_asserts \
          --python-flag=no_warnings \
          --lto=yes \
          --enable-plugin=tk-inter \
          --enable-plugin=upx \
          xadb.py

      - name: Package dist folder as ZIP
        run: |
          cd xadb.dist
          zip -r ../XtremeADB-macos.zip .
          cd ..

      - name: Upload ZIP artifact
        uses: actions/upload-artifact@v4
        with:
          name: XtremeADB-macos
          path: XtremeADB-macos.zip
